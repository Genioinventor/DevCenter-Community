<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mis Proyectos - DevCenter</title>
  <script src="../../bin-config.js"></script>
  <style>
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    body {
      font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #0a0a18 0%, #1a1a2e 50%, #16213e 100%);
      background-attachment: fixed;
      color: #fff;
      padding: 20px;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at 20% 30%, rgba(102, 126, 234, 0.08) 0%, transparent 50%),
                  radial-gradient(circle at 80% 70%, rgba(250, 204, 21, 0.05) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    .container { 
      max-width: 1200px; 
      margin: 0 auto; 
      padding: 0 20px 80px;
      position: relative;
      z-index: 1;
      animation: fadeInUp 0.6s ease-out;
    }
    
    .header-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 1rem;
      position: relative;
    }

    h1 {
      color: #facc15;
      text-align: center;
      font-size: clamp(1.8rem, 4vw, 3rem);
      margin: 0;
      text-shadow: 0 0 30px rgba(250, 204, 21, 0.6), 
                   0 4px 20px rgba(0, 0, 0, 0.4);
      font-weight: 900;
      letter-spacing: -1px;
      background: linear-gradient(135deg, #facc15 0%, #fde047 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .profile-icon {
      width: 54px;
      height: 54px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.35),
                  0 0 0 0 rgba(102, 126, 234, 0.4);
      position: relative;
      overflow: hidden;
    }

    .profile-icon::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.3) 0%, transparent 100%);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .profile-icon:hover::before {
      opacity: 1;
    }

    .profile-icon:hover {
      transform: translateY(-4px) scale(1.08);
      box-shadow: 0 12px 35px rgba(102, 126, 234, 0.5),
                  0 0 0 8px rgba(102, 126, 234, 0.15);
    }

    .profile-icon:active {
      transform: translateY(-2px) scale(1.04);
    }

    .subtitle {
      text-align: center;
      color: #a1a1aa;
      margin-bottom: 2.5rem;
      font-size: 1.05rem;
      font-weight: 500;
      letter-spacing: 0.3px;
    }

    .actions-bar {
      display: flex;
      gap: 12px;
      margin-bottom: 28px;
      flex-wrap: wrap;
    }

    .back-btn, .sync-btn, .add-btn {
      display: inline-block;
      padding: 14px 30px;
      color: white;
      text-decoration: none;
      border-radius: 16px;
      font-weight: 700;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: none;
      cursor: pointer;
      font-size: 1rem;
      position: relative;
      overflow: hidden;
      letter-spacing: 0.3px;
    }

    .back-btn::before, .sync-btn::before, .add-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .back-btn:hover::before, .sync-btn:hover::before, .add-btn:hover::before {
      width: 300px;
      height: 300px;
    }

    .back-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
    }

    .sync-btn {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
      box-shadow: 0 10px 25px rgba(34, 197, 94, 0.3);
    }

    .add-btn {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      box-shadow: 0 10px 25px rgba(245, 158, 11, 0.3);
      margin-left: auto;
    }

    .back-btn:hover, .sync-btn:hover, .add-btn:hover {
      transform: translateY(-3px) scale(1.02);
    }

    .back-btn:active, .sync-btn:active, .add-btn:active {
      transform: translateY(-1px) scale(1);
    }

    .projects-list {
      display: grid;
      gap: 24px;
    }

    .project-card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(250, 204, 21, 0.2);
      padding: 28px;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3),
                  inset 0 1px 0 rgba(255, 255, 255, 0.1);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .project-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, rgba(250, 204, 21, 0.5), transparent);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .project-card:hover::before {
      opacity: 1;
    }

    .project-card.pending {
      border: 1px solid rgba(251, 191, 36, 0.4);
      background: rgba(251, 191, 36, 0.06);
    }

    .project-card.synced {
      border: 1px solid rgba(34, 197, 94, 0.4);
      background: rgba(34, 197, 94, 0.06);
    }

    .sync-badge {
      position: absolute;
      top: 18px;
      right: 18px;
      padding: 7px 14px;
      border-radius: 10px;
      font-size: 0.7rem;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      backdrop-filter: blur(10px);
    }

    .sync-badge.pending {
      background: rgba(251, 191, 36, 0.25);
      color: #fbbf24;
      border: 1px solid rgba(251, 191, 36, 0.4);
      box-shadow: 0 4px 12px rgba(251, 191, 36, 0.2);
    }

    .sync-badge.synced {
      background: rgba(34, 197, 94, 0.25);
      color: #22c55e;
      border: 1px solid rgba(34, 197, 94, 0.4);
      box-shadow: 0 4px 12px rgba(34, 197, 94, 0.2);
    }

    .project-card:hover {
      border-color: rgba(250, 204, 21, 0.5);
      box-shadow: 0 16px 48px rgba(0, 0, 0, 0.4),
                  0 0 0 1px rgba(250, 204, 21, 0.1),
                  inset 0 1px 0 rgba(255, 255, 255, 0.15);
      transform: translateY(-4px);
    }

    .project-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      gap: 20px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .project-title { 
      font-size: 1.5rem; 
      color: #facc15; 
      margin-bottom: 12px; 
      font-weight: 800;
      letter-spacing: -0.5px;
      text-shadow: 0 2px 8px rgba(250, 204, 21, 0.3);
    }
    
    .project-url { 
      color: #60a5fa; 
      font-size: 0.95rem; 
      word-break: break-all; 
      margin-bottom: 12px;
      transition: color 0.2s;
      text-decoration: none;
    }

    .project-url:hover {
      color: #93c5fd;
      text-decoration: underline;
    }
    
    .project-description { 
      color: #d4d4d8; 
      margin-bottom: 14px; 
      line-height: 1.6;
      font-size: 1rem;
    }
    
    .project-tags { 
      display: flex; 
      flex-wrap: wrap; 
      gap: 8px; 
      margin-bottom: 12px; 
    }
    
    .tag { 
      background: rgba(59, 130, 246, 0.15); 
      color: #93c5fd; 
      padding: 6px 14px; 
      border-radius: 12px; 
      font-size: 0.85rem;
      font-weight: 700;
      border: 1px solid rgba(59, 130, 246, 0.3);
      transition: all 0.2s;
      letter-spacing: 0.3px;
    }

    .tag:hover {
      background: rgba(59, 130, 246, 0.25);
      border-color: rgba(59, 130, 246, 0.5);
      transform: translateY(-1px);
    }

    .status-badge {
      display: inline-block;
      padding: 7px 14px;
      border-radius: 10px;
      font-size: 0.75rem;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .project-meta { 
      font-size: 0.9rem; 
      color: #a1a1aa; 
      margin-top: 12px;
      font-weight: 500;
    }

    .btn {
      padding: 11px 20px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
      font-size: 0.95rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.5s, height 0.5s;
    }

    .btn:hover::before {
      width: 200px;
      height: 200px;
    }

    .btn-edit {
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
      color: white;
      margin-right: 10px;
      box-shadow: 0 6px 16px rgba(34, 197, 94, 0.3);
    }

    .btn-delete {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      box-shadow: 0 6px 16px rgba(239, 68, 68, 0.3);
    }

    .btn:hover { 
      transform: translateY(-3px) scale(1.02);
    }

    .btn:active {
      transform: translateY(-1px) scale(1);
    }

    .btn-edit:hover {
      box-shadow: 0 8px 22px rgba(34, 197, 94, 0.45);
    }

    .btn-delete:hover {
      box-shadow: 0 8px 22px rgba(239, 68, 68, 0.45);
    }

    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.88);
      backdrop-filter: blur(12px);
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 20px;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes modalSlideUp {
      from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .modal.show { 
      display: flex; 
    }

    .modal.show .modal-content {
      animation: modalSlideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .modal-content {
      background: linear-gradient(135deg, #18181b 0%, #1f1f23 100%);
      border-radius: 24px;
      padding: clamp(24px, 5vw, 36px);
      max-width: 620px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid rgba(250, 204, 21, 0.3);
      box-shadow: 0 25px 70px rgba(0, 0, 0, 0.7),
                  inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .modal h2 { 
      color: #facc15; 
      margin-bottom: 24px;
      font-size: 1.75rem;
      font-weight: 800;
      letter-spacing: -0.5px;
      text-shadow: 0 2px 10px rgba(250, 204, 21, 0.3);
    }

    .form-group { 
      margin-bottom: 18px; 
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #e4e4e7;
      font-weight: 700;
      font-size: 0.95rem;
      letter-spacing: 0.3px;
    }

    input, textarea, select {
      width: 100%;
      padding: 13px 16px;
      background: rgba(255, 255, 255, 0.08);
      border: 2px solid rgba(255, 255, 255, 0.15);
      border-radius: 12px;
      color: #fff;
      font-size: 1rem;
      font-weight: 500;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2),
                  inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }

    select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      cursor: pointer;
      padding-right: 40px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='9' viewBox='0 0 12 8'%3E%3Cpath fill='%23facc15' d='M1.41 0L6 4.58L10.59 0L12 1.41l-6 6l-6-6z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 14px center;
      background-size: 14px;
    }

    select option {
      background: #18181b;
      color: #fff;
      padding: 12px;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #facc15;
      background: rgba(255, 255, 255, 0.14);
      box-shadow: 0 0 0 4px rgba(250, 204, 21, 0.2), 
                  0 6px 20px rgba(0, 0, 0, 0.3);
      transform: translateY(-2px);
    }

    input::placeholder, textarea::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    textarea { 
      resize: vertical; 
      min-height: 90px;
      font-family: inherit;
    }

    .modal-buttons {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    .btn-save {
      flex: 1;
      background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
      color: white;
      padding: 15px;
      border: none;
      border-radius: 14px;
      font-weight: 800;
      cursor: pointer;
      font-size: 1.05rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 22px rgba(34, 197, 94, 0.3);
      letter-spacing: 0.3px;
      position: relative;
      overflow: hidden;
    }

    .btn-save::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .btn-save:hover::before {
      width: 300px;
      height: 300px;
    }

    .btn-save:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 30px rgba(34, 197, 94, 0.4);
    }

    .btn-save:active {
      transform: translateY(-1px);
    }

    .btn-cancel {
      flex: 1;
      background: linear-gradient(135deg, #71717a 0%, #52525b 100%);
      color: white;
      padding: 15px;
      border: none;
      border-radius: 14px;
      font-weight: 800;
      cursor: pointer;
      font-size: 1.05rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 22px rgba(113, 113, 122, 0.3);
      letter-spacing: 0.3px;
      position: relative;
      overflow: hidden;
    }

    .btn-cancel::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .btn-cancel:hover::before {
      width: 300px;
      height: 300px;
    }

    .btn-cancel:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 30px rgba(113, 113, 122, 0.4);
    }

    .btn-cancel:active {
      transform: translateY(-1px);
    }

    .message {
      text-align: center;
      padding: 14px 20px;
      border-radius: 14px;
      margin: 24px 0;
      font-weight: 700;
      font-size: 1rem;
      letter-spacing: 0.3px;
    }

    .message.success {
      background: rgba(34, 197, 94, 0.18);
      border: 1px solid rgba(34, 197, 94, 0.4);
      color: #4ade80;
      box-shadow: 0 6px 18px rgba(34, 197, 94, 0.2);
    }

    .message.error {
      background: rgba(239, 68, 68, 0.18);
      border: 1px solid rgba(239, 68, 68, 0.4);
      color: #fca5a5;
      box-shadow: 0 6px 18px rgba(239, 68, 68, 0.2);
    }

    .empty-state {
      text-align: center;
      padding: 80px 20px;
      color: #a1a1aa;
    }

    .empty-state h3 {
      font-size: 1.75rem;
      margin-bottom: 12px;
      font-weight: 800;
      color: #d4d4d8;
    }

    .status-activo { background: rgba(34, 197, 94, 0.18); color: #22c55e; border: 1px solid rgba(34, 197, 94, 0.3); font-weight: 800; }
    .status-community { background: rgba(99, 102, 241, 0.18); color: #818cf8; border: 1px solid rgba(99, 102, 241, 0.3); font-weight: 800; }
    .status-beta { background: rgba(251, 191, 36, 0.2); color: #fbbf24; border: 1px solid rgba(251, 191, 36, 0.35); font-weight: 800; }
    .status-stable { background: rgba(16, 185, 129, 0.18); color: #34d399; border: 1px solid rgba(16, 185, 129, 0.3); font-weight: 800; }
    .status-experimental { background: rgba(236, 72, 153, 0.18); color: #f472b6; border: 1px solid rgba(236, 72, 153, 0.3); font-weight: 800; }
    .status-premium { background: rgba(217, 119, 6, 0.18); color: #fb923c; border: 1px solid rgba(217, 119, 6, 0.3); font-weight: 800; }
    .status-free { background: rgba(34, 197, 94, 0.16); color: #4ade80; border: 1px solid rgba(34, 197, 94, 0.28); font-weight: 800; }
    .status-demo { background: rgba(2, 132, 199, 0.18); color: #38bdf8; border: 1px solid rgba(2, 132, 199, 0.3); font-weight: 800; }
    .status-urgent { background: rgba(239, 68, 68, 0.18); color: #f87171; border: 1px solid rgba(239, 68, 68, 0.3); font-weight: 800; }
    .status-archived { background: rgba(71, 85, 105, 0.18); color: #94a3b8; border: 1px solid rgba(71, 85, 105, 0.28); font-weight: 800; }
    .status-oficial { background: rgba(34, 197, 94, 0.22); color: #10b981; border: 1px solid rgba(34, 197, 94, 0.35); font-weight: 800; }

    .center-link-container {
      text-align: center;
      margin-top: 50px;
      margin-bottom: 50px;
    }

    .center-link-btn {
      display: inline-block;
      padding: 18px 48px;
      background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      color: white;
      text-decoration: none;
      border-radius: 16px;
      font-weight: 800;
      font-size: 1.15rem;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 10px 30px rgba(59, 130, 246, 0.35);
      letter-spacing: 0.3px;
      position: relative;
      overflow: hidden;
    }

    .center-link-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .center-link-btn:hover::before {
      width: 400px;
      height: 400px;
    }

    .center-link-btn:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 15px 40px rgba(59, 130, 246, 0.45);
    }

    .center-link-btn:active {
      transform: translateY(-2px) scale(1);
    }

    .profile-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.88);
      backdrop-filter: blur(12px);
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 20px;
      animation: fadeIn 0.3s ease-out;
    }

    .profile-modal.show { 
      display: flex; 
    }

    .profile-modal.show .profile-modal-content {
      animation: modalSlideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .profile-modal-content {
      background: linear-gradient(135deg, #18181b 0%, #1f1f23 100%);
      border-radius: 24px;
      padding: clamp(24px, 5vw, 36px);
      max-width: 540px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid rgba(250, 204, 21, 0.3);
      box-shadow: 0 25px 70px rgba(0, 0, 0, 0.7),
                  inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .profile-modal-content::-webkit-scrollbar {
      width: 8px;
    }

    .profile-modal-content::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
    }

    .profile-modal-content::-webkit-scrollbar-thumb {
      background: rgba(250, 204, 21, 0.4);
      border-radius: 10px;
    }

    .profile-modal-content::-webkit-scrollbar-thumb:hover {
      background: rgba(250, 204, 21, 0.6);
    }

    .profile-header {
      display: flex;
      align-items: center;
      gap: 18px;
      margin-bottom: 28px;
      padding-bottom: 24px;
      border-bottom: 2px solid rgba(250, 204, 21, 0.2);
    }

    .profile-avatar {
      width: 68px;
      height: 68px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.45),
                  inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }

    .profile-info h2 {
      color: #facc15;
      margin: 0;
      font-size: 1.65rem;
      font-weight: 800;
      letter-spacing: -0.5px;
      text-shadow: 0 2px 10px rgba(250, 204, 21, 0.3);
    }

    .profile-info p {
      color: #a1a1aa;
      margin: 6px 0 0 0;
      font-size: 0.95rem;
      font-weight: 500;
    }

    .cooldown-warning {
      background: rgba(251, 191, 36, 0.18);
      border: 1px solid rgba(251, 191, 36, 0.4);
      color: #fbbf24;
      padding: 14px;
      border-radius: 14px;
      margin-bottom: 22px;
      font-size: 0.95rem;
      text-align: center;
      font-weight: 700;
      letter-spacing: 0.3px;
      box-shadow: 0 4px 12px rgba(251, 191, 36, 0.2);
    }

    .logout-section {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 2px solid rgba(255, 255, 255, 0.1);
    }

    .btn-logout {
      width: 100%;
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      padding: 15px;
      border: none;
      border-radius: 14px;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 22px rgba(239, 68, 68, 0.3);
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 1.05rem;
      position: relative;
      overflow: hidden;
    }

    .btn-logout::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .btn-logout:hover::before {
      width: 300px;
      height: 300px;
    }

    .btn-logout:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 30px rgba(239, 68, 68, 0.45);
    }

    .btn-logout:active {
      transform: translateY(-1px);
    }

    @media(max-width:768px) {
      body {
        padding: 15px;
      }
      
      .container {
        padding: 0 15px 60px;
      }
      
      h1 {
        font-size: clamp(1.6rem, 5vw, 2.2rem);
      }
      
      .subtitle {
        font-size: 0.95rem;
        margin-bottom: 2rem;
      }
      
      .modal-content, .profile-modal-content {
        padding: clamp(20px, 4vw, 28px);
        max-height: 85vh;
      }

      .profile-modal {
        padding: 15px;
      }

      .profile-header {
        gap: 14px;
        margin-bottom: 22px;
        padding-bottom: 20px;
      }

      .profile-avatar {
        width: 56px;
        height: 56px;
        font-size: 26px;
      }

      .profile-info h2 {
        font-size: 1.4rem;
      }

      .profile-info p {
        font-size: 0.9rem;
      }
      
      input, textarea, select {
        font-size: 16px;
      }
    }
    
    @media(max-width:640px) {
      body {
        padding: 12px;
      }
      
      .container {
        padding: 0 12px 50px;
      }
      
      h1 {
        font-size: clamp(1.4rem, 5vw, 1.8rem);
      }
      
      .subtitle {
        font-size: 0.9rem;
        margin-bottom: 1.75rem;
      }
      
      .actions-bar {
        flex-direction: column;
        gap: 8px;
      }
      
      .back-btn, .sync-btn, .add-btn {
        padding: 11px 20px;
        font-size: 0.9rem;
      }
      
      .add-btn {
        margin-left: 0 !important;
      }
      
      .btn {
        padding: 8px 14px;
        font-size: 0.85rem;
      }

      .project-header > div:last-child {
        width: 100%;
        display: flex;
        gap: 8px;
      }

      .project-header > div:last-child .btn {
        flex: 1;
        margin: 0;
      }

      .header-container {
        flex-direction: column;
        gap: 10px;
      }

      .profile-icon {
        position: absolute;
        top: -10px;
        right: 10px;
        width: 45px;
        height: 45px;
        font-size: 22px;
      }
      
      .project-card {
        padding: 20px;
      }
      
      .project-title {
        font-size: 1.2rem;
      }
      
      .project-url {
        font-size: 0.85rem;
      }
      
      .modal-buttons {
        flex-direction: column;
      }
      
      .btn-save, .btn-cancel {
        width: 100%;
      }

      .profile-modal {
        padding: 12px;
      }

      .profile-modal-content {
        padding: 20px;
        max-height: 88vh;
        border-radius: 20px;
      }

      .profile-header {
        gap: 12px;
        margin-bottom: 20px;
        padding-bottom: 18px;
      }

      .profile-avatar {
        width: 50px;
        height: 50px;
        font-size: 24px;
      }

      .profile-info h2 {
        font-size: 1.25rem;
      }

      .profile-info p {
        font-size: 0.85rem;
      }

      .form-group {
        margin-bottom: 16px;
      }

      .btn-logout {
        padding: 13px;
        font-size: 0.95rem;
      }
    }
    
    @media(max-width:480px) {
      body {
        padding: 10px;
      }
      
      .profile-icon {
        width: 40px;
        height: 40px;
        font-size: 20px;
        top: -8px;
        right: 8px;
      }
      
      .project-card {
        padding: 16px;
        border-radius: 14px;
      }
      
      .project-title {
        font-size: 1.1rem;
      }
      
      .tag {
        font-size: 0.75rem;
        padding: 4px 10px;
      }
      
      .modal-content {
        padding: 16px;
        border-radius: 16px;
      }
      
      .modal h2 {
        font-size: 1.3rem;
      }

      .profile-modal {
        padding: 10px;
      }

      .profile-modal-content {
        padding: 18px;
        max-height: 92vh;
        border-radius: 18px;
      }

      .profile-header {
        gap: 10px;
        margin-bottom: 18px;
        padding-bottom: 16px;
        flex-direction: row;
      }

      .profile-avatar {
        width: 46px;
        height: 46px;
        font-size: 22px;
      }

      .profile-info h2 {
        font-size: 1.15rem;
        letter-spacing: -0.3px;
      }

      .profile-info p {
        font-size: 0.8rem;
      }

      .cooldown-warning {
        padding: 12px;
        font-size: 0.85rem;
        margin-bottom: 18px;
      }

      .form-group {
        margin-bottom: 14px;
      }

      label {
        font-size: 0.85rem;
        margin-bottom: 6px;
      }

      input, textarea, select {
        padding: 11px 14px;
        font-size: 16px;
      }

      .modal-buttons {
        margin-top: 20px;
        gap: 10px;
      }

      .btn-save, .btn-cancel {
        padding: 13px;
        font-size: 0.95rem;
      }

      .btn-logout {
        padding: 12px;
        font-size: 0.9rem;
        letter-spacing: 0.5px;
      }

      .logout-section {
        margin-top: 20px;
        padding-top: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header-container">
      <h1>Mis Proyectos Web</h1>
      <div class="profile-icon" onclick="openProfileModal()" title="Mi perfil">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
      </div>
    </div>
    <p class="subtitle">Gestiona tus p√°ginas web. Solo puedes hacer un cambio cada 24 horas.</p>
    <div id="timeRemaining" class="message" style="display: none;"></div>
    
    <div class="actions-bar">
      <a href="index.html" class="back-btn">‚Üê Volver</a>
      <a href="index.html" class="add-btn">+ Agregar Nuevo Proyecto</a>
    </div>

    <div id="message"></div>
    <div id="projectsList" class="projects-list"></div>
    
    <div class="center-link-container">
      <a href="/" class="center-link-btn">Centro de Paginas Web</a>
    </div>
  </div>

  <!-- Modal para editar -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <h2>Editar Proyecto</h2>
      <form id="editForm">
        <div class="form-group">
          <label>T√≠tulo</label>
          <input type="text" id="editTitle" required maxlength="20">
        </div>
        <div class="form-group">
          <label>URL</label>
          <input type="url" id="editUrl" required maxlength="57">
        </div>
        <div class="form-group">
          <label>Tags (separados por coma)</label>
          <input type="text" id="editTags" maxlength="150">
        </div>
        <div class="form-group">
          <label>Descripci√≥n</label>
          <textarea id="editDescription" maxlength="500"></textarea>
        </div>
        <div class="form-group">
          <label>Iniciales</label>
          <input type="text" id="editInitials" maxlength="2">
        </div>
        <div class="form-group">
          <label>Estado</label>
          <select id="editStatus">
            <option value="activo">Activo</option>
            
            <option value="community">Community</option>
            <option value="beta">Beta</option>
            <option value="stable">Stable</option>
            <option value="experimental">Experimental</option>
            <option value="premium">Premium</option>
            <option value="free">Free</option>
            <option value="demo">Demo</option>
            <option value="urgent">Urgent</option>
            <option value="archived">Archived</option>
          </select>
        </div>
        <div class="modal-buttons">
          <button type="submit" class="btn-save">Guardar Cambios</button>
          <button type="button" class="btn-cancel" onclick="closeEditModal()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal de Perfil -->
  <div id="profileModal" class="profile-modal">
    <div class="profile-modal-content">
      <div class="profile-header">
        <div class="profile-avatar">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </div>
        <div class="profile-info">
          <h2>Mi Perfil</h2>
          <p id="profileUsername">Usuario</p>
        </div>
      </div>

      <div id="profileCooldownWarning" class="cooldown-warning" style="display: none;">
        ‚è±Ô∏è Podr√°s editar tu perfil en: <span id="profileCooldownTime"></span>
      </div>

      <form id="profileForm">
        <div class="form-group">
          <label>Nombre de Usuario</label>
          <input type="text" id="profileName" required maxlength="30">
        </div>
        <div class="form-group">
          <label>Correo Electr√≥nico</label>
          <input type="email" id="profileEmail" required maxlength="100">
        </div>
        <div class="form-group">
          <label>Nueva Contrase√±a (dejar vac√≠o para mantener actual)</label>
          <input type="password" id="profilePassword" maxlength="50" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        <div class="modal-buttons">
          <button type="submit" class="btn-save" id="saveProfileBtn">Guardar Cambios</button>
          <button type="button" class="btn-cancel" onclick="closeProfileModal()">Cancelar</button>
        </div>
      </form>

      <div class="logout-section">
        <button class="btn-logout" onclick="handleProfileLogout()">üö™ Cerrar Sesi√≥n</button>
      </div>
    </div>
  </div>

  <script>
    let myProjects = [];
    let editingIndex = -1;
    let currentUser = null;
    const PROJECTS_BIN_ID = window.BIN_CONFIG?.PROJECTS_BIN_ID || '68af329cae596e708fd92637';

    function getCurrentUser() {
      const userStr = localStorage.getItem('currentUser');
      if (!userStr) {
        alert('‚ö†Ô∏è Debes iniciar sesi√≥n primero.');
        window.location.href = '/Creator/index.html';
        return null;
      }
      try {
        const userData = JSON.parse(userStr);
        currentUser = userData.username || userData.usuario || userStr;
        return currentUser;
      } catch {
        currentUser = userStr;
        return userStr;
      }
    }

    async function getUserProjectsFromBin() {
      const username = getCurrentUser();
      if (!username) return [];

      try {
        const response = await fetch(`https://api.jsonbin.io/v3/b/${PROJECTS_BIN_ID}/latest`, {
          cache: 'no-store'
        });
        
        if (!response.ok) {
          console.error('Error al cargar proyectos del bin:', response.status);
          return [];
        }

        const data = await response.json();
        const allProjects = data.record?.projects || [];
        
        // Filtrar proyectos donde el campo "owner" coincide con el nombre del usuario
        const userProjects = allProjects.filter(project => {
          return project.owner && project.owner === username;
        });
        
        return userProjects;
      } catch (error) {
        console.error('Error cargando proyectos del bin:', error);
        return [];
      }
    }

    function getUserProjects() {
      const user = getCurrentUser();
      if (!user) return [];
      
      const allUserProjects = JSON.parse(localStorage.getItem('user_projects') || '{}');
      return allUserProjects[user] || [];
    }

    function saveUserProjects(projects) {
      const user = getCurrentUser();
      if (!user) return;
      
      const allUserProjects = JSON.parse(localStorage.getItem('user_projects') || '{}');
      allUserProjects[user] = projects;
      localStorage.setItem('user_projects', JSON.stringify(allUserProjects));
    }

    function showMessage(text, type = 'success') {
      const msg = document.getElementById('message');
      msg.textContent = text;
      msg.className = `message ${type}`;
      setTimeout(() => msg.className = 'message', 5000);
    }

    function getTimeRemaining() {
      const user = getCurrentUser();
      if (!user) return null;
      
      const lastEdit = localStorage.getItem(`lastEdit_${user}`);
      if (!lastEdit) return null;
      
      const lastEditTime = new Date(lastEdit).getTime();
      const currentTime = new Date().getTime();
      const timePassed = currentTime - lastEditTime;
      const twentyFourHours = 24 * 60 * 60 * 1000; // 24 horas en milisegundos
      
      if (timePassed >= twentyFourHours) {
        return null; // Ya puede editar
      }
      
      const timeRemaining = twentyFourHours - timePassed;
      return timeRemaining;
    }

    function formatTimeRemaining(milliseconds) {
      const hours = Math.floor(milliseconds / (1000 * 60 * 60));
      const minutes = Math.floor((milliseconds % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((milliseconds % (1000 * 60)) / 1000);
      
      return `${hours}h ${minutes}m ${seconds}s`;
    }

    function updateTimeDisplay() {
      const timeRemaining = getTimeRemaining();
      const timeDiv = document.getElementById('timeRemaining');
      
      if (timeRemaining) {
        timeDiv.textContent = `‚è±Ô∏è Podr√°s editar en: ${formatTimeRemaining(timeRemaining)}`;
        timeDiv.className = 'message error';
        timeDiv.style.display = 'block';
      } else {
        timeDiv.style.display = 'none';
      }
    }

    function canEditToday() {
      return getTimeRemaining() === null;
    }

    function openEditModal(index) {
      const timeRemaining = getTimeRemaining();
      if (timeRemaining) {
        showMessage(`Solo puedes hacer un cambio cada 24 horas. Podr√°s editar en: ${formatTimeRemaining(timeRemaining)}`, 'error');
        return;
      }
      
      editingIndex = index;
      const project = myProjects[index];
      
      document.getElementById('editTitle').value = project.title || '';
      document.getElementById('editUrl').value = project.url || '';
      document.getElementById('editTags').value = Array.isArray(project.tags) ? project.tags.join(', ') : '';
      document.getElementById('editDescription').value = project.description || '';
      document.getElementById('editInitials').value = project.initials || '';
      document.getElementById('editStatus').value = project.status || 'activo';
      
      document.getElementById('editModal').classList.add('show');
    }

    function closeEditModal() {
      document.getElementById('editModal').classList.remove('show');
      editingIndex = -1;
    }

    async function deleteProject(index) {
      if (!confirm('¬øEst√°s seguro de eliminar este proyecto?')) return;
      
      const projectToDelete = myProjects[index];
      const user = getCurrentUser();
      myProjects.splice(index, 1);
      saveUserProjects(myProjects);

      // Si el proyecto estaba sincronizado, eliminarlo de AMBOS bins
      if (projectToDelete.synced) {
        try {
          // Eliminar del bin principal
          const resp = await fetch(`https://api.jsonbin.io/v3/b/${PROJECTS_BIN_ID}/latest`, { cache: 'no-store' });
          if (resp.ok) {
            const raw = await resp.json();
            const currentProjects = raw.record?.projects || [];
            const meta = raw.record?.meta || {};
            
            const updatedProjects = currentProjects.filter(p => p.id !== projectToDelete.id);
            meta.projects_count = updatedProjects.length;
            meta.updated = new Date().toISOString();
            
            await fetch(`https://api.jsonbin.io/v3/b/${PROJECTS_BIN_ID}`, {
              method: 'PUT',
              headers: {
                'Content-Type': 'application/json',
                'X-Access-Key': '$2a$10$IbCel6X/gSLaMz/uH3pPdeZbyKT6nzBvjc/U7Bi9ToIg8zWuqxIQy',
                'X-Bin-Versioning': 'false'
              },
              body: JSON.stringify({ meta, projects: updatedProjects })
            });
            
            showMessage('Proyecto eliminado exitosamente.', 'success');
          }
        } catch (err) {
          showMessage('Proyecto eliminado localmente. Error al sincronizar: ' + err.message, 'error');
        }
      } else {
        showMessage('Proyecto eliminado localmente.', 'success');
      }
      
      loadProjects();
    }

    document.getElementById('editForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (editingIndex === -1) return;
      
      const user = getCurrentUser();
      const tags = document.getElementById('editTags').value.split(',').map(t => t.trim()).filter(Boolean);
      const wasSynced = myProjects[editingIndex].synced;
      
      myProjects[editingIndex] = {
        ...myProjects[editingIndex],
        title: document.getElementById('editTitle').value.trim(),
        url: document.getElementById('editUrl').value.trim(),
        tags: tags,
        description: document.getElementById('editDescription').value.trim(),
        initials: document.getElementById('editInitials').value.trim().toUpperCase() || myProjects[editingIndex].initials,
        status: document.getElementById('editStatus').value,
        synced: false
      };
      
      saveUserProjects(myProjects);
      localStorage.setItem(`lastEdit_${user}`, new Date().toISOString());

      // Si estaba sincronizado, actualizar en AMBOS bins (principal y usuarios)
      if (wasSynced) {
        try {
          // Actualizar bin principal
          const resp = await fetch(`https://api.jsonbin.io/v3/b/${PROJECTS_BIN_ID}/latest`, { cache: 'no-store' });
          if (resp.ok) {
            const raw = await resp.json();
            const currentProjects = raw.record?.projects || [];
            const meta = raw.record?.meta || {};
            
            const projectIndex = currentProjects.findIndex(p => p.id === myProjects[editingIndex].id);
            if (projectIndex !== -1) {
              currentProjects[projectIndex] = {
                id: myProjects[editingIndex].id,
                title: myProjects[editingIndex].title,
                url: myProjects[editingIndex].url,
                tags: myProjects[editingIndex].tags,
                initials: myProjects[editingIndex].initials,
                status: myProjects[editingIndex].status,
                description: myProjects[editingIndex].description,
                dateAdded: myProjects[editingIndex].dateAdded,
                owner: user
              };
              
              meta.updated = new Date().toISOString();
              
              await fetch(`https://api.jsonbin.io/v3/b/${PROJECTS_BIN_ID}`, {
                method: 'PUT',
                headers: {
                  'Content-Type': 'application/json',
                  'X-Access-Key': '$2a$10$IbCel6X/gSLaMz/uH3pPdeZbyKT6nzBvjc/U7Bi9ToIg8zWuqxIQy',
                  'X-Bin-Versioning': 'false'
                },
                body: JSON.stringify({ meta, projects: currentProjects })
              });
              
              myProjects[editingIndex].synced = true;
              saveUserProjects(myProjects);
              showMessage('Proyecto actualizado exitosamente.', 'success');
            }
          }
        } catch (err) {
          showMessage('Proyecto actualizado localmente. Error al sincronizar: ' + err.message, 'error');
        }
      } else {
        showMessage('Proyecto actualizado localmente. Recuerda sincronizar con la API.', 'success');
      }
      
      closeEditModal();
      loadProjects();
    });

    async function loadProjects() {
      const binProjects = await getUserProjectsFromBin();
      const localProjects = getUserProjects();

      const projectsMap = new Map();
      
      localProjects.forEach(p => {
        projectsMap.set(p.id, { ...p, source: 'local' });
      });
      
      binProjects.forEach(p => {
        if (projectsMap.has(p.id)) {
          projectsMap.set(p.id, { ...projectsMap.get(p.id), ...p, synced: true, source: 'both' });
        } else {
          projectsMap.set(p.id, { ...p, synced: true, source: 'bin' });
        }
      });

      myProjects = Array.from(projectsMap.values());
      
      const container = document.getElementById('projectsList');
      container.innerHTML = '';
      
      updateTimeDisplay();
      
      if (myProjects.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <h3>No tienes proyectos a√∫n</h3>
            <p>Agrega tu primer proyecto web para comenzar</p>
          </div>
        `;
        return;
      }
      
      myProjects.forEach((project, index) => {
        const card = document.createElement('div');
        card.className = 'project-card';
        
        const tags = Array.isArray(project.tags) ? project.tags : [];
        const tagsHtml = tags.map(t => `<span class="tag">${t}</span>`).join('');
        
        card.innerHTML = `
          <div class="project-header">
            <div>
              <div class="project-title">${project.title || 'Sin t√≠tulo'}</div>
              <div class="project-url">${project.url || ''}</div>
              <span class="status-badge status-${project.status || 'activo'}">${(project.status || 'activo').toUpperCase()}</span>
              <div class="project-meta">Iniciales: ${project.initials || '--'} | Creado: ${project.dateAdded ? new Date(project.dateAdded).toLocaleDateString() : 'N/A'}</div>
            </div>
            <div>
              <button class="btn btn-edit" onclick="openEditModal(${index})">Editar</button>
              <button class="btn btn-delete" onclick="deleteProject(${index})">Eliminar</button>
            </div>
          </div>
        `;
        
        container.appendChild(card);
      });
    }

    async function syncWithAPI() {
      const pendingProjects = myProjects.filter(p => !p.synced);
      
      if (pendingProjects.length === 0) {
        showMessage('No hay cambios pendientes para sincronizar.', 'success');
        return;
      }

      const syncBtn = document.getElementById('syncBtn');
      syncBtn.disabled = true;
      showMessage('Sincronizando con la API...', 'success');

      try {
        // Obtener el bin actual
        const resp = await fetch(`https://api.jsonbin.io/v3/b/68af329cae596e708fd92637/latest`, { cache: 'no-store' });
        if (!resp.ok) throw new Error('Error al obtener proyectos de la API');
        const raw = await resp.json();
        
        const currentProjects = raw.record?.projects || [];
        const meta = raw.record?.meta || {};

        // Agregar proyectos pendientes que no existan ya
        for (const project of pendingProjects) {
          const exists = currentProjects.some(p => 
            (p.title || '').toLowerCase() === project.title.toLowerCase() || 
            (p.url || '').toLowerCase() === project.url.toLowerCase()
          );
          
          if (!exists) {
            const apiProject = {
              id: project.id,
              title: project.title,
              url: project.url,
              tags: project.tags,
              initials: project.initials,
              status: project.status,
              description: project.description,
              dateAdded: project.dateAdded
            };
            currentProjects.push(apiProject);
          }
        }

        // Actualizar meta
        meta.projects_count = currentProjects.length;
        meta.updated = new Date().toISOString();

        // Guardar en el bin principal
        const putResp = await fetch(`https://api.jsonbin.io/v3/b/68af329cae596e708fd92637`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'X-Access-Key': '$2a$10$IbCel6X/gSLaMz/uH3pPdeZbyKT6nzBvjc/U7Bi9ToIg8zWuqxIQy',
            'X-Bin-Versioning': 'false'
          },
          body: JSON.stringify({ meta, projects: currentProjects })
        });

        if (!putResp.ok) throw new Error('Error al sincronizar bin principal');

        // Marcar proyectos como sincronizados
        myProjects.forEach(p => p.synced = true);
        saveUserProjects(myProjects);

        showMessage('¬°Proyectos sincronizados exitosamente en ambos bins! ‚úÖ', 'success');
        loadProjects();
      } catch (err) {
        showMessage('Error al sincronizar: ' + err.message, 'error');
      } finally {
        syncBtn.disabled = false;
      }
    }

    if (getCurrentUser()) {
      loadProjects();
      
      // Actualizar el contador cada segundo
      setInterval(() => {
        updateTimeDisplay();
      }, 1000);
    }

    // ========== FUNCIONES DE PERFIL ==========
    const PROFILE_COOLDOWN_MS = 10 * 24 * 60 * 60 * 1000; // 10 d√≠as

    function getProfileCooldownRemaining() {
      const user = getCurrentUser();
      if (!user) return null;
      
      const lastEdit = localStorage.getItem(`lastProfileEdit_${user}`);
      if (!lastEdit) return null;
      
      const lastEditTime = new Date(lastEdit).getTime();
      const currentTime = new Date().getTime();
      const timePassed = currentTime - lastEditTime;
      
      if (timePassed >= PROFILE_COOLDOWN_MS) {
        return null;
      }
      
      return PROFILE_COOLDOWN_MS - timePassed;
    }

    function formatProfileTimeRemaining(milliseconds) {
      const s = Math.floor(milliseconds / 1000);
      const days = Math.floor(s / 86400);
      const hours = Math.floor((s % 86400) / 3600);
      const mins = Math.floor((s % 3600) / 60);
      
      return `${days}d ${hours}h ${mins}m`;
    }

    function canEditProfile() {
      return getProfileCooldownRemaining() === null;
    }

    async function getUserData() {
      const username = getCurrentUser();
      if (!username) return null;

      try {
        const response = await fetch('https://api.jsonbin.io/v3/b/68d03bc343b1c97be94a869d/latest', {
          cache: 'no-store',
          headers: {
            'X-Master-Key': '$2a$10$T9JNKL.CKGpxmMKnezehF.Syu388j3.OKXpK03rZ1yBjyKkkR6RHO',
            'X-Access-Key': '$2a$10$.nQ.uG0/J/vI4ixoUxK/deluru7qVGIfU5gDLcv7X3s8fjzJhzC8G'
          }
        });

        if (!response.ok) return null;
        
        const data = await response.json();
        const usuarios = data.record?.usuarios || [];
        return usuarios.find(u => u.usuario === username);
      } catch (error) {
        console.error('Error obteniendo datos de usuario:', error);
        return null;
      }
    }

    async function openProfileModal() {
      const profileModal = document.getElementById('profileModal');
      const userData = await getUserData();
      
      if (!userData) {
        alert('Error al cargar datos de perfil');
        return;
      }

      document.getElementById('profileUsername').textContent = userData.usuario;
      document.getElementById('profileName').value = userData.usuario;
      document.getElementById('profileEmail').value = userData.correo_electronico || '';
      document.getElementById('profilePassword').value = '';

      const cooldownRemaining = getProfileCooldownRemaining();
      const cooldownWarning = document.getElementById('profileCooldownWarning');
      const saveBtn = document.getElementById('saveProfileBtn');

      if (cooldownRemaining) {
        cooldownWarning.style.display = 'block';
        document.getElementById('profileCooldownTime').textContent = formatProfileTimeRemaining(cooldownRemaining);
        saveBtn.disabled = true;
        
        // Actualizar el contador en tiempo real
        const interval = setInterval(() => {
          const remaining = getProfileCooldownRemaining();
          if (remaining) {
            document.getElementById('profileCooldownTime').textContent = formatProfileTimeRemaining(remaining);
          } else {
            clearInterval(interval);
            cooldownWarning.style.display = 'none';
            saveBtn.disabled = false;
          }
        }, 1000);
      } else {
        cooldownWarning.style.display = 'none';
        saveBtn.disabled = false;
      }

      profileModal.classList.add('show');
    }

    function closeProfileModal() {
      document.getElementById('profileModal').classList.remove('show');
    }

    document.getElementById('profileForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      if (!canEditProfile()) {
        const remaining = getProfileCooldownRemaining();
        showMessage(`Solo puedes editar tu perfil cada 10 d√≠as. Podr√°s editar en: ${formatProfileTimeRemaining(remaining)}`, 'error');
        return;
      }

      const newUsername = document.getElementById('profileName').value.trim();
      const newEmail = document.getElementById('profileEmail').value.trim();
      const newPassword = document.getElementById('profilePassword').value.trim();

      if (!newUsername || !newEmail) {
        showMessage('El nombre y correo son obligatorios', 'error');
        return;
      }

      try {
        const response = await fetch('https://api.jsonbin.io/v3/b/68d03bc343b1c97be94a869d/latest', {
          cache: 'no-store',
          headers: {
            'X-Master-Key': '$2a$10$T9JNKL.CKGpxmMKnezehF.Syu388j3.OKXpK03rZ1yBjyKkkR6RHO',
            'X-Access-Key': '$2a$10$.nQ.uG0/J/vI4ixoUxK/deluru7qVGIfU5gDLcv7X3s8fjzJhzC8G'
          }
        });

        if (!response.ok) throw new Error('Error al cargar usuarios');

        const data = await response.json();
        const usuarios = data.record?.usuarios || [];
        const currentUsername = getCurrentUser();
        const userIndex = usuarios.findIndex(u => u.usuario === currentUsername);

        if (userIndex === -1) throw new Error('Usuario no encontrado');

        // Verificar si el nuevo nombre ya existe (si cambi√≥)
        if (newUsername !== currentUsername) {
          const exists = usuarios.some(u => u.usuario === newUsername);
          if (exists) {
            showMessage('Ese nombre de usuario ya est√° en uso', 'error');
            return;
          }
        }

        // Actualizar datos
        usuarios[userIndex].usuario = newUsername;
        usuarios[userIndex].correo_electronico = newEmail;
        if (newPassword) {
          usuarios[userIndex].contrasena = newPassword;
        }

        // Guardar cambios
        const putResponse = await fetch('https://api.jsonbin.io/v3/b/68d03bc343b1c97be94a869d', {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'X-Master-Key': '$2a$10$T9JNKL.CKGpxmMKnezehF.Syu388j3.OKXpK03rZ1yBjyKkkR6RHO',
            'X-Access-Key': '$2a$10$.nQ.uG0/J/vI4ixoUxK/deluru7qVGIfU5gDLcv7X3s8fjzJhzC8G',
            'X-Bin-Versioning': 'false'
          },
          body: JSON.stringify({ usuarios })
        });

        if (!putResponse.ok) throw new Error('Error al guardar cambios');

        // Actualizar localStorage
        localStorage.setItem('currentUser', JSON.stringify({ usuario: newUsername, username: newUsername }));
        localStorage.setItem(`lastProfileEdit_${newUsername}`, new Date().toISOString());

        showMessage('‚úÖ Perfil actualizado exitosamente', 'success');
        closeProfileModal();
        
        // Actualizar la UI
        document.getElementById('profileUsername').textContent = newUsername;
        
      } catch (error) {
        showMessage('Error al actualizar perfil: ' + error.message, 'error');
      }
    });

    function handleProfileLogout() {
      if (confirm('¬øEst√°s seguro de que quieres cerrar sesi√≥n?')) {
        localStorage.removeItem('currentUser');
        localStorage.removeItem('authToken');
        localStorage.removeItem('adminAccess');
        window.location.href = '/';
      }
    }

    // Cerrar modal al hacer clic fuera
    document.getElementById('profileModal').addEventListener('click', (e) => {
      if (e.target.id === 'profileModal') {
        closeProfileModal();
      }
    });
  </script>
</body>
</html>
